Locus.IDs<- sapply(cnv.list, '[[',2)
Locus.IDs.sorted <- apply(Locus.IDs,2,sort,decreasing=F)
Locus.IDs<- sapply(threshold_cnv_list, '[[',2)
Locus.IDs.sorted <- apply(Locus.IDs,2,sort,decreasing=F)
identical.Locus.IDs<- rep(NA, ncol(Locus.IDs.sorted))
for (i in 1: ncol(Locus.IDs.sorted)){
identical.Locus.IDs[i]<- identical(Locus.IDs.sorted[,1], Locus.IDs.sorted[,i])
}
identical.Locus.IDs
names(threshold_short_cnv_list_loc)
getwd()
?getwd
install.packages("survival")
library(survival)
attach(melanom)
attach(Melanoma)
install.packages("ISwR")
attach(melanom)
library(ISwR)
attach(melanom)
names(melanom)
melanom$status
melanom$days
Surv(days, status == 1)
Surv(days)
Surv(days, ulc == 10)
Surv(days, status == 1)
survfit(Surv(days, status == 1))
survfit(Surv(days, status==1))
survfit(formula =  Surv(days, status==1))
Surv(days, status == 1)
surv(days, status == 1)
Surv(days, status == 1)
survfit(Surv(days, status == 1))
surv.all<- survfit(Surv(days, status == 1))
survfit(Surv(days, status == 1))
library(survival)
attach(melanom)
names(melanom)
melanom$status
melanom$days
Surv(days, status == 1)
survfit(Surv(days, status == 1))
> msurv <- with(melanom, Surv(days, status == 1))
msurv <- with(melanom, Surv(days, status == 1))
msurv
mfit <- survfit(Surv(days, status == 1), data = melanom)
survfit(Surv(days, status == 1)~1)
surv.all<- survfit(Surv(days, status == 1)~1)
surv.all
summary(surv.all)
plot(surv.all)
surv_by_sex<- survfit(Surv(days, status==1)~sex)
surv_by_sex
plot(surv_by_sex)
plot(surv_by_sex, conf.int=T, col=c("black", "grey"))
plot(surv.all, conf.int = F)
surv_by_sex<- survfit(Surv(days, status==1)~sex, conf.int=0.99)
surv_by_sex
plot(surv_by_sex, conf.int=T, col=c("black", "grey"))
survdiff(Surv(days, status==1)~sex)
survdiff(surv_by_sex)
surv_by_sex<- survfit(Surv(days, status==1)~sex)
surv_by_sex
survdiff(surv_by_sex~1)
survdiff(surv_by_sex~sex)
survdiff(surv.all~sex)
survdiff(Surv(days, status==1)~sex)
survdiff(Surv(days, status==1)~sex + strata(ulc))
summary(coxph(Surv(days, status==1)~sex))
survdiff(Surv(days, status==1)~sex)
summary(coxph(Surv(days, status==1)~sex+log(thick)+strata(ulc)))
plot(survfit(coxph(Surv(days, status ==1)~log(thick)+sex+strata(ulc))))
plot(survfit(coxph(Surv(days, status ==1)~log(thick)+sex)))
plot(survfit(coxph(Surv(days, status ==1)~sex)))
plot(survfit(coxph(Surv(days, status ==1)~sex+strata(ulc))))
plot(survfit(coxph(Surv(days, status ==1)~log(thick)+sex+strata(ulc))))
plot(survfit(coxph(Surv(days, status ==1)~sex+strata(ulc))))
BRCA_clinical<- read.delim("/Users/Matt/Documents/Masters_Bioinformatics/Internships/Input data/clinical/BRCA_clinical.tsv", header = TRUE, stringsAsFactors = FALSE)
clinical <- t(read.table("/Users/Matt/Documents/Masters_Bioinformatics/Internships/Input data/Survival analysis and gene expression tutorial/BRCA/gdac.broadinstitute.org_BRCA.Merge_Clinical.Level_1.2016012800.0.0/BRCA.merged_only_clinical_clin_format.txt",header=T, row.names=1, sep='\t'))
clinical
clinical <- t(read.delim("/Users/Matt/Documents/Masters_Bioinformatics/Internships/Input data/Survival analysis and gene expression tutorial/BRCA/gdac.broadinstitute.org_BRCA.Merge_Clinical.Level_1.2016012800.0.0/BRCA.merged_only_clinical_clin_format.txt",header=T, row.names=1))
dim(clinical)
clinical[1:2, 1:10]
?toupper
colnames(clinical)
colnames(clinical)
clinical_names<- colnames(clinical)
clinical_names
colnames(clinical)<- clinical_names
colnames(clinical)
BRCA_clinical$tcga_participant_barcode
colnames(BRCA_clinical)
colnames(clinical)
clinical[1,1]
BRCA_clinical[1,1]
clinical <- read.delim("/Users/Matt/Documents/Masters_Bioinformatics/Internships/Input data/Survival analysis and gene expression tutorial/BRCA/gdac.broadinstitute.org_BRCA.Merge_Clinical.Level_1.2016012800.0.0/BRCA.merged_only_clinical_clin_format.txt",header=T, row.names=1)
dim(clinical)
clinical[1:2, 1:10]
t_clinical<- t(clinical)
t_clinical[1:2, 1:4]
clinical <- t(read.delim("/Users/Matt/Documents/Masters_Bioinformatics/Internships/Input data/Survival analysis and gene expression tutorial/BRCA/gdac.broadinstitute.org_BRCA.Merge_Clinical.Level_1.2016012800.0.0/BRCA.merged_only_clinical_clin_format.txt",header=T))
clinical[1:2, 1:10]
clinical_col_names<-clinical[1,]
clinical_col_names
length(clinical_col_names)
ncol(clinical)
colnames(clinical)<- clinical_col_names
colnames(clinical)
grep(patient.bcr_patient_barcode,colnames(clinical))
grep("patient.bcr_patient_barcode",colnames(clinical))
clinical <- t(read.delim("/Users/Matt/Documents/Masters_Bioinformatics/Internships/Input data/Survival analysis and gene expression tutorial/BRCA/gdac.broadinstitute.org_BRCA.Merge_Clinical.Level_1.2016012800.0.0/BRCA.merged_only_clinical_clin_format.txt",header=T, row.names=1))
dim(clinical)
clinical[1:2, 1:10]
clinical_names<- colnames(clinical)
colnames(clinical)
clinical[1,1]
ind_keep <- grep("patient.bcr_patient_barcode",colnames(clinical))
clinical[,ind_keep]
ind_keep <- grep('days_to_new_tumor_event_after_initial_treatment',colnames(clinical))
ind_keep
new_tum <- as.matrix(clinical[,ind_keep])
new_tum
dim(new_tum)
new_tum_collapsed <- c()
new_tum_collapsed
dim(new_tum)
i=1
is.na(new_tum[i,])
( sum ( is.na(new_tum[i,])) < dim(new_tum)[2])
dim(new_tum)[2]
sum ( is.na(new_tum[i,]))
( sum ( is.na(new_tum[i,])) < dim(new_tum)[2])
min(new_tum[i,],na.rm=T)
for (i in 1:dim(new_tum)[1]){
if ( sum ( is.na(new_tum[i,])) < dim(new_tum)[2]){
m <- min(new_tum[i,],na.rm=T)
new_tum_collapsed <- c(new_tum_collapsed,m)
} else {
new_tum_collapsed <- c(new_tum_collapsed,'NA')
}
}
new_tum_collapsed
ind_keep <- grep('days_to_death',colnames(clinical))
death <- as.matrix(clinical[,ind_keep])
death_collapsed <- c()
i=1
( is.na(death[i,]))
sum ( is.na(death[i,]))
max(death[i,],na.rm=T)
ind_keep <- grep('days_to_death',colnames(clinical))
ind_keep
death <- as.matrix(clinical[,ind_keep])
death_collapsed <- c()
sum ( is.na(death[i,])) < dim(death)[2])
sum ( is.na(death[i,])) < dim(death)[2]
max(death[i,],na.rm=T)
ind_keep <- grep('days_to_death',colnames(clinical))
death <- as.matrix(clinical[,ind_keep])
death_collapsed <- c()
for (i in 1:dim(death)[1]){
if ( sum ( is.na(death[i,])) < dim(death)[2]){
m <- max(death[i,],na.rm=T)
death_collapsed <- c(death_collapsed,m)
} else {
death_collapsed <- c(death_collapsed,'NA')
}
}
death_collapsed
ind_keep <- grep('days_to_last_followup',colnames(clinical))
ind_keep <- grep('days_to_last_followup',colnames(clinical))
ind_keep
fl <- as.matrix(clinical[,ind_keep])
fl_collapsed <- c()
(is.na(fl[i,])
)
sum (is.na(fl[i,]))
dim(fl)[2]
max(fl[i,],na.rm=T)
min(fl[i,],na.rm=T)
ind_keep <- grep('days_to_last_followup',colnames(clinical))
fl <- as.matrix(clinical[,ind_keep])
fl_collapsed <- c()
for (i in 1:dim(fl)[1]){
if ( sum (is.na(fl[i,])) < dim(fl)[2]){
m <- max(fl[i,],na.rm=T)
fl_collapsed <- c(fl_collapsed,m)
} else {
fl_collapsed <- c(fl_collapsed,'NA')
}
}
fl_collapsed
all_clin <- data.frame(new_tum_collapsed,death_collapsed,fl_collapsed)
colnames(all_clin) <- c('new_tumor_days', 'death_days', 'followUp_days')
head(all_clin)
tail(all_clin)
head(all_clin, 20)
tail(all_clin, 20)
all_clin$new_time <- c()
head(all_clin, 20)
all_clin$new_time <- c()
head(all_clin, 20)
all_clin$new_tumor_days
as.character(all_clin$new_tumor_days)
as.numeric(all_clin$new_tumor_days)
as.numeric(as.character(all_clin$new_tumor_days)))
as.numeric(as.character(all_clin$new_tumor_days))
all_clin$new_time <- c()
for (i in 1:length(as.numeric(as.character(all_clin$new_tumor_days)))){
all_clin$new_time[i] <- ifelse ( is.na(as.numeric(as.character(all_clin$new_tumor_days))[i]),
as.numeric(as.character(all_clin$followUp_days))[i],as.numeric(as.character(all_clin$new_tumor_days))[i])
}
head(all_clin, 20)
tail(all_clin, 20)
all_clin$new_death <- c()
for (i in 1:length(as.numeric(as.character(all_clin$death_days)))){
all_clin$new_death[i] <- ifelse ( is.na(as.numeric(as.character(all_clin$death_days))[i]),
as.numeric(as.character(all_clin$followUp_days))[i],as.numeric(as.character(all_clin$death_days))[i])
}
head(all_clin, 20)
ind_keep <- grep('patient.vital_status',colnames(clinical))
ind_keep
ind_keep <- grep('patient.vital_status',colnames(clinical))
table(clinical[,ind_keep])
clinical[,ind_keep]
all_clin$death_event <- ifelse(clinical[,ind_keep] == 'alive', 0,1)
clinical_IDS<- clinical[,ind_keep]
ind_keep <- grep("patient.bcr_patient_barcode",colnames(clinical))
clinical_IDS<- clinical[,ind_keep]
clinical_IDS
length(clinical_IDS)
nrow(all_clin)
rownames(all_clin) <- clinical_IDS
head(all_clin, 20)
?tryCatch
all_clin$new_death
class(all_clin$new_death)
all_clin
head(all_clin, 20)
surv(new_death, death_event == 1, data = all_clin)
Surv(new_death, death_event == 1, data = all_clin)
s<- survfit(Surv(new_death, death_event == 1), data = all_clin)
all_clin
s<- survfit(Surv("new_death", death_event == 1), data = all_clin)
s<- survfit(Surv("new_death", "death_event" == 1), data = all_clin)
s<- survfit(Surv(as.numeric(as.character("new_death")), "death_event" == 1), data = all_clin)
s<- survfit(Surv(as.numeric(as.character("new_death")), "death_event" == 1)~1, data = all_clin)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin)
s
options(survfit.print.mean = TRUE)
s
s<- survfit(Surv(as.numeric(as.character("new_death")), "death_event" == 1)~1, data = all_clin, survfit.print.mean = TRUE)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin, survfit.print.mean = TRUE)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin)
s
options(survfit.print.mean = TRUE)
s
s
options(survfit.print.mean = TRUE)
s
?survfit.print.mean
??survfit.print.mean
plot(s)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin)
s<- survfit(Surv(as.numeric(as.character("new_death")), "death_event" == 1)~1, data = all_clin, survfit.print.mean = TRUE)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin)
s
?survfit
summary(s)
head(all_clin, 20)
s1<- survfit(Surv(new_new, death_event == 1)~1, data = all_clin)
s1<- survfit(Surv(new_time, death_event == 1)~1, data = all_clin)
s1
summary(s1)
plot(s1)
ind_keep <- grep('days_to_death',colnames(BRCA))
ind_keep <- grep('days_to_death',colnames(BRCA_clinical))
ind_keep
death_collapsed2
ind_keep <- grep('days_to_death',colnames(BRCA_clinical))
ind_keep
fl_collapsed2
ind_keep <- grep('days_to_death',colnames(BRCA_clinical))
ind_keep
death2 <- as.matrix(BRCA_clinical[,ind_keep])
death_collapsed2
death2 <- as.matrix(BRCA_clinical[,ind_keep])
death_collapsed2 <- c()
death_collapsed2
death2
death_collapsed2 <- c()
for (i in 1:dim(death2)[1]){
if ( sum ( is.na(death2[i,])) < dim(death2)[2]){
m <- max(death2[i,],na.rm=T)
death_collapsed2 <- c(death_collapsed2,m)
} else {
death_collapsed2 <- c(death_collapsed2,'NA')
}
}
death_collapsed2
ind_keep <- grep('days_to_last_followup',colnames(BRCA_clinical))
ind_keep
fl2 <- as.matrix(BRCA_clinical[,ind_keep])
fl2
fl_collapsed2 <- c()
fl_collapsed2
fl_collapsed2 <- c()
for (i in 1:dim(fl2)[1]){
if ( sum (is.na(fl2[i,])) < dim(fl2)[2]){
m <- max(fl2[i,],na.rm=T)
fl_collapsed2 <- c(fl_collapsed2,m)
} else {
fl_collapsed2 <- c(fl_collapsed2,'NA')
}
}
fl_collapsed2
fl_collapsed2
all_clin2 <- data.frame(death_collapsed2,fl_collapsed2)
colnames(all_clin2) <- c('death_days', 'followUp_days')
head(all_clin2, 20)
tail(all_clin2, 20)
head(all_clin2, 20)
all_clin2$new_death <- c()
for (i in 1:length(as.numeric(as.character(all_clin2$death_days)))){
all_clin2$new_death[i] <- ifelse ( is.na(as.numeric(as.character(all_clin2$death_days))[i]),
as.numeric(as.character(all_clin2$followUp_days))[i],as.numeric(as.character(all_clin2$death_days))[i])
}
head(all_clin2, 20)
head(all_clin2, 20)
ind_keep <- grep('patient.vital_status',colnames(BRCA_clinical))
BRCA_clinical[,ind_keep]
ind_keep <- grep('vital_status',colnames(BRCA_clinical))
BRCA_clinical[,ind_keep]
table(BRCA_clinical[,ind_keep])
all_clin2$death_event <- ifelse(BRCA_clinical[,ind_keep] == 'alive', 0,1)
ind_keep <- grep("patient.bcr_patient_barcode",colnames(BRCA_clinical))
ind_keep
clinical_IDS<- BRCA_clinical$tcga_participant_barcode
clinical_IDS
length(clinical_IDS)
nrow(all_clin)
nrow(all_clin2)
rownames(all_clin2) <- clinical_IDS
head(all_clin2, 20)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin2)
s
summary(s)
plot(s)
s1<- survfit(Surv(new_time, death_event == 1)~1, data = all_clin2)
s1
summary(s1)
plot(s1)
s<- survfit(Surv(new_death, death_event == 1)~1, data = all_clin2)
s
summary(s)
plot(s)
clinical_IDS2<- BRCA_clinical$tcga_participant_barcode
clinical_IDS2
length(clinical_IDS2)
nrow(all_clin2)
rownames(all_clin2) <- clinical_IDS2
head(all_clin2, 20)
ind_keep <- grep("patient.bcr_patient_barcode",colnames(clinical))
clinical_IDS<- clinical[,ind_keep]
clinical_IDS
clinical_IDS[1:2]
clinical_IDS2[1:2]
clinical_IDS2
clinical_IDS
clinical_IDS2
clinical_IDS
toupper(clinical_IDS)
as.vector(toupper(clinical_IDS))
clinical_IDS2
clinical_ID_dataset_fget<- clinical_IDS2
clinical_ID_dataset1_firehose<- as.vector(toupper(clinical_IDS))
sort(clinical_IDS2, decreasing = FALSE
)
clinical_ID_dataset_fget<- sort(clinical_IDS2, decreasing = FALSE)
clinical_ID_dataset_fget[1:10]
clinical_ID_dataset1_firehose<- sort(clinical_ID_dataset1_firehose, decreasing = FALSE)
clinical_ID_dataset_fget[1:10]
clinical_ID_dataset1_firehose[1:10]
identical(clinical_ID_dataset_fget, clinical_ID_dataset1_firehose)
all_clin
all_clin$ID<- as.vector(toupper(clinical_IDS))
head(all_clin, 20)
clinical_IDS2
all_clin2$ID<- clinical_IDS2
head(all_clin2, 20)
all_clin[order(all_clin$ID),]
all_clin<- all_clin[order(all_clin$ID),]
all_clin2<- all_clin2[order(all_clin2$ID),]
head(all_clin2, 20)
head(all_clin, 20)
head(all_clin2, 20)
identical(all_clin$death_days, all_clin$death_days)
identical(all_clin$death_days, all_clin2$death_days)
identical(all_clin$death_event, all_clin2$death_event)
?identical
which(all_clin$death_event %in% all_clin2$death_event)
which(!(all_clin$death_event %in% all_clin2$death_event)
which(!(all_clin$death_event %in% all_clin2$death_event)
)
which(!(all_clin$death_event %in% all_clin2$death_event))
?identical
identical(all_clin$death_event, all_clin2$death_event, ignore.environment = TRUE)
b<- c(0, 0, 1, 1, 0, 0)
which(a %in% b)
a<- c(0, 0, 1, 0, 1, 1)
b<- c(0, 0, 1, 1, 0, 0)
which(a %in% b)
which(a %in% b, arr.ind = T)
match(a,b)
all.equal(a,b)
all.equal(a,b)
all(a,b)
which(a, b)
?which
a==b
which(a==b)
which(!(a==b))
a
b
which(!(all_clin$death_days == all_clin2$death_days))
identical(all_clin$death_days, all_clin2$death_days)
identical(all_clin$death_days, all_clin2$death_days)
identical(all_clin$death_event, all_clin2$death_event)
which(!(all_clin$death_event == all_clin2$death_event))
indicies<- which(!(all_clin$death_event == all_clin2$death_event))
indicies
all_clin_combined<- cbind(all_clin, all_clin2)
head(all_clin_combined)
all_clin_combined[indicies,]
all_clin_combined[indicies,] %>% dplyr::select(ID, death_days, followUp_days, new_death, death_event)
all_clin_combined[indicies,]
all_clin_combined[indicies,]
cnv.table<-threshold_short_cnv_list_loc[[1]]
co_deletions_distance_from_target_gene_plot_table<- distance_from_target_gene_co_deletion_co_amplification_function(cnv.table = cnv.table, gene_information_list = gene_information_list, distance = 2.5e+06, deletion = TRUE, threshold = -2, compare_all_genes = FALSE, normalisation = "tumours.with.event")
dim(co_deletions_distance_from_target_gene_plot_table)
head(co_deletions_distance_from_target_gene_plot_table)
tail(co_deletions_distance_from_target_gene_plot_table)
class(co_deletions_distance_from_target_gene_plot_table$proportion_co_del_amp)
ggplot(co_deletions_distance_from_target_gene_plot_table[1:100,], aes(Comparison_gene, as.numeric(proportion_co_del_amp))) +
geom_bar(stat = "identity", aes(fill = Target_gene)) +
facet_wrap(~Target_gene, nrow = 1, scales = "free_x") +
theme(legend.position="none") +
theme(axis.text.x=element_text(angle=90,hjust=1, vjust = 0.5))
ggplot(co_deletions_distance_from_target_gene_plot_table[1:100,],
aes(Comparison_gene, as.numeric(proportion_co_del_amp), colour = Target_gene)) +
geom_line(stat = "identity", aes(group = Target_gene)) +
facet_wrap(~Target_gene, nrow = 1, scales = "free_x") +
theme(legend.position="none") +
theme(axis.text.x=element_text(angle=90,hjust=1, vjust = 0.5))
mean_co_deletion_co_amplification_values_around_gene<- function(co_deletion_table,
distance_from_gene_to_calculate_mean){
n<- distance_from_gene_to_calculate_mean
result<-rep(NA, nrow(co_deletion_table))
for(i in 1: nrow(co_deletion_table)){
if(i < n){
start<- i
end<- i+n
result[i]<- mean(co_deletion_table[i, start:end])
} else if((i >= n) & (i+n-1 < ncol(co_deletion_table))) {
start<- i-n
end<- i+n
result[i]<- mean(co_deletion_table[i, start:end])
} else if(i+n > ncol(co_deletion_table)) {
start<- i-n
end<- ncol(co_deletion_table)
result[i]<- mean(co_deletion_table[i, start:end])
}
}
return(result)
}
distance<- 2.5e+06
co.deletion.per.target.gene<- lapply(gene_information_list, function(x) co.deletion_co.amplification_matrix(cnv.table, column_start = 11, threshold = -2, start = TRUE, Chromosome = x[[2]], selection_criteria = c(x[[4]] - distance, x[[5]] + distance), deletion = TRUE, normalisation = "tumours.with.event"))
length(co.deletion.per.target.gene)
co.deletion.per.target.gene[[2]]
test<- mean_co_deletion_co_amplification_values_around_gene(co.deletion.per.target.gene[[2]], 1)
test
length(test)
dim(co.deletion.per.target.gene[[2]])
co_deletion_around_target_gene<- lapply(co.deletion.per.target.gene, function(x) mean_co_deletion_co_amplification_values_around_gene(x,1))
length(co_deletion_around_target_gene)
co_deletion_around_target_gene[[2]]
identical(test, co_deletion_around_target_gene[[2]])
co_deletion_around_target_gene2<- lapply(co.deletion.per.target.gene, function(x) mean_co_deletion_co_amplification_values_around_gene(x,2))
length(co_deletion_around_target_gene2)
co_deletion_around_target_gene2[[2]]
co_deletion_around_target_gene<- unlist(co_deletion_around_target_gene)
co_deletion_around_target_gene
co_deletion_around_target_gene2<- unlist(co_deletion_around_target_gene2)
co_deletion_around_target_gene2
length(co_deletion_around_target_gene)
dim(co_deletions_distance_from_target_gene_plot_table)
co_deletions_distance_from_target_gene_plot_table<- cbind(co_deletions_distance_from_target_gene_plot_table, co_deletion_around_target_gene)
dim(co_deletions_distance_from_target_gene_plot_table)
head(co_deletions_distance_from_target_gene_plot_table)
tail(co_deletions_distance_from_target_gene_plot_table)
co_deletions_distance_from_target_gene_plot_table<- cbind(co_deletions_distance_from_target_gene_plot_table, co_deletion_around_target_gene2)
ggplot(co_deletions_distance_from_target_gene_plot_table, aes(x=Comparison_gene, group = Target_gene)) +
geom_point(aes(y = as.numeric(proportion_co_del_amp), colour = "Co-deletion with target gene"), size = 0.5, shape = 1) +
geom_line(aes(y = as.numeric(proportion_co_del_amp), colour = "Co-deletion with target gene")) +
geom_point(aes(y = as.numeric(co_deletion_around_target_gene), colour = "Mean co-deletion for genes 1 gene away"), size = 0.5, shape = 1) +
geom_line(aes(y = as.numeric(co_deletion_around_target_gene), colour = "Mean co-deletion for genes 1 gene away")) +
#facet_wrap(~Target_gene, nrow = 1, scales = "free_x") +
facet_wrap(~Target_gene, scales = "free_x") +
#theme(legend.position="none") +
theme(legend.position="bottom") +
theme(axis.text.x=element_text(angle=90,hjust=1, vjust = 0.5))
all_clin_combined[indicies,]
